#!/bin/bash

if [ -z ${QMAKE:-} ]
then
    QMAKE=$(which qmake)
fi

SPEC=${SPEC:-linux-clang-libc++}

readonly CFLAGS="-fsanitize=address -fno-omit-frame-pointer"
readonly LFLAGS="-fsanitize=address"

set -e -x

"$QMAKE" \
    -spec "$SPEC" \
    CONFIG+=debug \
    QMAKE_CFLAGS+="$CFLAGS" \
    QMAKE_CXXFLAGS*="$CFLAGS" \
    QMAKE_LFLAGS*="$LFLAGS" \
    "$@"
